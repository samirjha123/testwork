<source>
  type tail
  path /var/log/httpd/access_log
  tag apache.count
  format apache
  pos_file /var/log/td-agent/apache_access.pos
</source>

<match apache.count>
  type copy
  <store>
    type file
    path /tmp/debug.log
  </store>
  <store>
    type dynamodb_atomiccounter
    aws_key_id <%= node['td-agent']['fluent-plugin-dynamodb-atomiccounter']['access_key'] %>
    aws_sec_key <%= node['td-agent']['fluent-plugin-dynamodb-atomiccounter']['secret_key'] %>
    dynamo_db_endpoint <%= node['td-agent']['fluent-plugin-dynamodb-atomiccounter']['endpoint'] %>
    dynamo_db_table <%= node['td-agent']['fluent-plugin-dynamodb-atomiccounter']['table'] %>
    tag dynamo.count.data
    flush_interval <%= node['td-agent']['fluent-plugin-dynamodb-atomiccounter']['interval'] %>
  </store>
</match>
